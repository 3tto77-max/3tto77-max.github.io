<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vexo Player</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #videoPlayer {
            width: 100%;
            height: 100%;
            object-fit: contain;
            background: #000;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .container:hover .controls {
            opacity: 1;
        }
        
        button {
            background: rgba(245, 158, 11, 0.8);
            color: black;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        
        button:hover {
            background: rgba(245, 158, 11, 1);
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #f59e0b;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }
        
        /* Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø« */
        .hidden-info {
            display: none;
        }
    </style>
    
    <!-- Shaka Player Ù„Ù„Ø¨Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.11/shaka-player.ui.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.11/controls.css">
</head>
<body>
    <div class="container">
        <!-- Ø¥Ø®ÙØ§Ø¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ø« -->
        <div class="hidden-info" id="streamData"></div>
        
        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ -->
        <div class="error" id="errorMessage"></div>
        
        <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
        <div class="loading" id="loading">
            <div style="font-size: 24px; margin-bottom: 10px;">â–¶</div>
            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«...</p>
        </div>
        
        <!-- Ù…Ø´ØºÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ -->
        <video id="videoPlayer" autoplay controls playsinline></video>
        
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… -->
        <div class="controls">
            <button onclick="togglePlay()" id="playBtn">â¸</button>
            <button onclick="toggleMute()" id="muteBtn">ğŸ”‡</button>
            <button onclick="toggleFullscreen()">â›¶</button>
        </div>
    </div>

    <script>
        // Ù…ØªØºÙŠØ±Ø§Øª
        let player;
        let isPlaying = false;
        let isMuted = false;
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                title: params.get('title') || 'Vexo Stream',
                scheme: params.get('scheme') || '',
                key: params.get('key') || '',
                url: params.get('url') || ''
            };
        }
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø´ØºÙ„
        async function initPlayer() {
            const streamData = getUrlParams();
            
            if (!streamData.url) {
                showError('Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«');
                return;
            }
            
            try {
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒÙˆÙ†Ø³ÙˆÙ„ ÙÙ‚Ø·
                console.log('Stream loaded:', {
                    title: streamData.title,
                    scheme: streamData.scheme ? 'Yes' : 'No',
                    hasKey: streamData.key ? 'Yes' : 'No',
                    urlLength: streamData.url.length
                });
                
                // ØªÙ‡ÙŠØ¦Ø© Shaka Player
                shaka.polyfill.installAll();
                
                if (shaka.Player.isBrowserSupported()) {
                    player = new shaka.Player(document.getElementById('videoPlayer'));
                    
                    // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´ØºÙ„
                    player.configure({
                        streaming: {
                            bufferingGoal: 30,
                            rebufferingGoal: 2
                        }
                    });
                    
                    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù
                    await player.load(streamData.url);
                    
                    // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                    document.getElementById('loading').style.display = 'none';
                    
                    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
                    document.getElementById('videoPlayer').play();
                    isPlaying = true;
                    
                } else {
                    showError('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù†ÙˆØ¹ Ù…Ù† Ø§Ù„Ø¨Ø«');
                }
                
            } catch (error) {
                console.error('Error:', error);
                showError('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø«: ' + error.message);
            }
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ´ØºÙŠÙ„/Ø§Ù„Ø¥ÙŠÙ‚Ø§Ù
        function togglePlay() {
            const video = document.getElementById('videoPlayer');
            if (isPlaying) {
                video.pause();
                document.getElementById('playBtn').textContent = 'â–¶';
            } else {
                video.play();
                document.getElementById('playBtn').textContent = 'â¸';
            }
            isPlaying = !isPlaying;
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ ÙƒØªÙ… Ø§Ù„ØµÙˆØª
        function toggleMute() {
            const video = document.getElementById('videoPlayer');
            video.muted = !video.muted;
            isMuted = video.muted;
            document.getElementById('muteBtn').textContent = isMuted ? 'ğŸ”Š' : 'ğŸ”‡';
        }
        
        // Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
        function toggleFullscreen() {
            const video = document.getElementById('videoPlayer');
            if (!document.fullscreenElement) {
                video.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }
        
        // Ø¹Ø±Ø¶ Ø®Ø·Ø£
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('errorMessage').innerHTML = `
                <div style="font-size: 20px; margin-bottom: 10px;">âš ï¸</div>
                <p>${message}</p>
                <button onclick="location.reload()" style="margin-top: 10px;">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
            `;
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('load', initPlayer);
        
        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
        window.addEventListener('error', function(e) {
            console.error('Page error:', e);
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ø¹Ù†Ø¯ ÙÙ‚Ø¯Ø§Ù† Ø§Ù„Ø§ØªØµØ§Ù„
        window.addEventListener('online', function() {
            if (player && !isPlaying) {
                location.reload();
            }
        });
    </script>
</body>
</html>
